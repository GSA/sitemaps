<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sitemaps::Instance
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Sitemaps/Instance.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Sitemaps.html" title="Sitemaps (module)">Sitemaps</a></span></span>
     &raquo; 
    <span class="title">Instance</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Sitemaps::Instance
  
  
  <span class="private note title">Private</span>
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sitemaps::Instance</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/sitemaps.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This class is part of a private API.</strong>
  You should avoid using this class if possible, as it may be removed or be changed in the future.
</p>

<p>Holder for methods that shouldn&#39;t be exposed as public API</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#discover_roots-instance_method" title="#discover_roots (instance method)">- (Array&lt;URI&gt;) <strong>discover_roots</strong>(url, fetcher) </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>interrogate a host for sitemaps from robots.txt, or return some potential
locations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_recursive-instance_method" title="#fetch_recursive (instance method)">- (Sitemap) <strong>fetch_recursive</strong>(urls, fetcher, max_entries, filter_indexes, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>recursively fetch sitemaps and sitemap indexes from the given urls.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="discover_roots-instance_method">
  
    - (<tt>Array&lt;URI&gt;</tt>) <strong>discover_roots</strong>(url, fetcher) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>interrogate a host for sitemaps from robots.txt, or return some potential
locations.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;URI&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sitemaps.rb', line 168</span>

<span class='kw'>def</span> <span class='id identifier rubyid_discover_roots'>discover_roots</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_fetcher'>fetcher</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_robots'>robots</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_robotsurl'>robotsurl</span>      <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
    <span class='id identifier rubyid_robotsurl'>robotsurl</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/robots.txt</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_robotstxt'>robotstxt</span>      <span class='op'>=</span> <span class='id identifier rubyid_fetcher'>fetcher</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_robotsurl'>robotsurl</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_discovered'>discovered</span> <span class='op'>=</span> <span class='id identifier rubyid_robotstxt'>robotstxt</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^Sitemap: (.+)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_discovered'>discovered</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_discovered'>discovered</span>
  <span class='kw'>rescue</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># try for files in a handful of known locations
</span>  <span class='id identifier rubyid_known_locations'>known_locations</span> <span class='op'>=</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>/sitemap_index.xml.gz</span><span class='words_sep'> </span><span class='tstring_content'>/sitemap_index.xml</span><span class='words_sep'> </span><span class='tstring_content'>/sitemap.xml.gz</span><span class='words_sep'> </span><span class='tstring_content'>/sitemap.xml</span><span class='words_sep'>)</span>
  <span class='id identifier rubyid_known_locations'>known_locations</span> <span class='op'>=</span> <span class='id identifier rubyid_known_locations'>known_locations</span><span class='period'>.</span><span class='id identifier rubyid_lazy'>lazy</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='id identifier rubyid_pathurl'>pathurl</span>      <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
    <span class='id identifier rubyid_pathurl'>pathurl</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span>
    <span class='id identifier rubyid_pathurl'>pathurl</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_robots'>robots</span> <span class='op'>||</span> <span class='id identifier rubyid_known_locations'>known_locations</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_recursive-instance_method">
  
    - (<tt><span class='object_link'><a href="Sitemap.html" title="Sitemaps::Sitemap (class)">Sitemap</a></span></tt>) <strong>fetch_recursive</strong>(urls, fetcher, max_entries, filter_indexes, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>recursively fetch sitemaps and sitemap indexes from the given urls.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Sitemap.html" title="Sitemaps::Sitemap (class)">Sitemap</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sitemaps.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_recursive'>fetch_recursive</span><span class='lparen'>(</span><span class='id identifier rubyid_urls'>urls</span><span class='comma'>,</span> <span class='id identifier rubyid_fetcher'>fetcher</span><span class='comma'>,</span> <span class='id identifier rubyid_max_entries'>max_entries</span><span class='comma'>,</span> <span class='id identifier rubyid_filter_indexes'>filter_indexes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_queue'>queue</span> <span class='op'>=</span> <span class='id identifier rubyid_urls'>urls</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_urls'>urls</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='id identifier rubyid_urls'>urls</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_maps'>maps</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># walk the queue, fetching the sitemap requested and adding
</span>  <span class='comment'># new sitemaps to the queue as found
</span>  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>next</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_maps'>maps</span><span class='lbracket'>[</span><span class='id identifier rubyid_url'>url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

      <span class='comment'># fetch this item in the queue, and queue up any sub maps it found
</span>      <span class='id identifier rubyid_source'>source</span>  <span class='op'>=</span> <span class='id identifier rubyid_fetcher'>fetcher</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sitemap'>sitemap</span> <span class='op'>=</span> <span class='const'>Sitemaps</span><span class='op'>::</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='label'>max_entries:</span> <span class='id identifier rubyid_max_entries'>max_entries</span><span class='comma'>,</span> <span class='label'>filter:</span> <span class='id identifier rubyid_block'>block</span><span class='comma'>,</span> <span class='label'>filter_indexes:</span> <span class='id identifier rubyid_filter_indexes'>filter_indexes</span><span class='rparen'>)</span>

      <span class='comment'># save the results and queue up any submaps it found
</span>      <span class='id identifier rubyid_maps'>maps</span><span class='lbracket'>[</span><span class='id identifier rubyid_url'>url</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_sitemap'>sitemap</span>
      <span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_sitemap'>sitemap</span><span class='period'>.</span><span class='id identifier rubyid_sitemaps'>sitemaps</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:loc</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='comment'># decrement max_entries (since it&#39;s max_entries total, not per map)
</span>      <span class='kw'>unless</span> <span class='id identifier rubyid_max_entries'>max_entries</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_max_entries'>max_entries</span> <span class='op'>-=</span> <span class='id identifier rubyid_maps'>maps</span><span class='lbracket'>[</span><span class='id identifier rubyid_url'>url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_max_entries'>max_entries</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='comment'># otherwise keep on going, because we&#39;ve got something at least
</span>      <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR FETCHING: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>, ignoring...</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># collapse the recovered maps into a single one with everything
</span>  <span class='id identifier rubyid_maps'>maps</span><span class='period'>.</span><span class='id identifier rubyid_each_with_object'>each_with_object</span><span class='lparen'>(</span><span class='const'>Sitemap</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_map'>map</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_sitemaps'>sitemaps</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_sitemaps'>sitemaps</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_loc'>loc</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>   <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_loc'>loc</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Mar 25 14:00:46 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.2).
</div>

  </body>
</html>